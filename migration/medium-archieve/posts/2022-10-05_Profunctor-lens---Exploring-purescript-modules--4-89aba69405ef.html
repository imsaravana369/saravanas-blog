<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Profunctor-lens‚Ää‚Äî‚ÄäExploring-purescript-modules #4</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">Profunctor-lens‚Ää‚Äî‚ÄäExploring-purescript-modules #4</h1>
</header>
<section data-field="subtitle" class="p-summary">
Working  with complex nested data structures becomes smooth, scalable and Effortless.
</section>
<section data-field="body" class="e-content">
<section name="e47f" class="section section--body section--first"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="5500" id="5500" class="graf graf--h3 graf--leading graf--title">Profunctor-lens‚Ää‚Äî‚ÄäExploring-purescript-modules #4</h3><p name="6533" id="6533" class="graf graf--p graf-after--h3">Let‚Äôs say you have the below complex data structure,</p><pre name="9d77" id="9d77" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code">type NestedData =<br>  Maybe (Array <br>     { foo :: Tuple String (Either Int Boolean)<br>     , bar :: String })</code></pre><p name="f16f" id="f16f" class="graf graf--p graf-after--pre">If I tell you to flip the deeply nested boolean value at a particular Index, how would you do that?</p><pre name="aff8" id="aff8" class="graf graf--pre graf-after--p">flipBool :: Int -&gt; NestedData -&gt; NestedData<br>flipBool index = case _ of <br>    Nothing -&gt; Nothing <br>    Just arr -&gt; modifyAt index modifyFooFoo arr<br>    where<br>      modifyFooFoo rec = rec { foo = modifyTuple rec.foo}<br>      modifyTuple (Tuple first sec) = Tuple first (modifyEither sec)<br>      modifyEither ei = not &lt;$&gt; ei</pre><p name="19f2" id="19f2" class="graf graf--p graf-after--pre">Do we need to write a complex function like the one above? What happens if the structure of <code class="markup--code markup--p-code">NestedData</code> changes? We have to again make a lot of changes to our function. So, Is there any easy way to modify &amp; retrieve data inside these complex data structuresüßê? Yes, there is, they are called Optics. With Optics you could do something like</p><pre name="3218" id="3218" class="graf graf--pre graf-after--p">flipBool :: Int -&gt; NestedData -&gt; NestedData<br>flipBool index nestedData = over boolGetter not nestedData<br>    where<br>       boolGetter = (_Just &lt;&lt;&lt; ix index &lt;&lt;&lt; _foo &lt;&lt;&lt; _2 &lt;&lt;&lt; _Right)</pre><p name="08d3" id="08d3" class="graf graf--p graf-after--pre">See the line of code is reduced by 50%, even though I haven‚Äôt explained anything about the above syntax, you could easily grab it by yourself by just looking at the above code blockPhoto by <a href="https://unsplash.com/@jamesbold?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" data-href="https://unsplash.com/@jamesbold?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">James Bold</a> on <a href="https://unsplash.com/s/photos/lens?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" data-href="https://unsplash.com/s/photos/lens?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Unsplash</a></p><p name="527c" id="527c" class="graf graf--p graf-after--p">The below are contents are inspired largely from <a href="https://thomashoneyman.com/articles/practical-profunctor-lenses-optics/" data-href="https://thomashoneyman.com/articles/practical-profunctor-lenses-optics/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">this</a> article published by <a href="https://github.com/thomashoneyman/" data-href="https://github.com/thomashoneyman/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Thomas Honeyman</a>.</p><figure name="bdad" id="bdad" class="graf graf--figure graf-after--p graf--trailing"><img class="graf-image" data-image-id="1*IPVKLYshuikMtnAC8OqnYA.jpeg" data-width="2400" data-height="1600" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/1*IPVKLYshuikMtnAC8OqnYA.jpeg"><figcaption class="imageCaption">Photo by <a href="https://unsplash.com/@jamesbold?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" data-href="https://unsplash.com/@jamesbold?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" class="markup--anchor markup--figure-anchor" rel="noopener" target="_blank">James Bold</a> on¬†<a href="https://unsplash.com/s/photos/lens?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" data-href="https://unsplash.com/s/photos/lens?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" class="markup--anchor markup--figure-anchor" rel="noopener" target="_blank">Unsplash</a></figcaption></figure></div></div></section><section name="b566" class="section section--body"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="f5a3" id="f5a3" class="graf graf--h3 graf--leading">Types of¬†Optics</h3><p name="8a7e" id="8a7e" class="graf graf--p graf-after--h3">Before diving into how the above function works, let‚Äôs understand some core concepts in Optics.</p><p name="3705" id="3705" class="graf graf--p graf-after--p">There are four types of optics that are used often. They are Prism, Lens, Traversal and Iso. Every optic describe a relationship between a structure <code class="markup--code markup--p-code">s</code>and a zero, or more values of type <code class="markup--code markup--p-code">a</code>.</p><pre name="0569" id="0569" class="graf graf--pre graf-after--p">Optic s a <br>// s =&gt; Structure like Maybe a, Either a, Array a etc<br>// a =&gt; (one or more) Value (the `a` inside the above types)</pre><p name="c682" id="c682" class="graf graf--p graf-after--pre"><code class="markup--code markup--p-code">Prism</code> represents optics which represent structure <code class="markup--code markup--p-code">s </code>from which we may or may not get a value of type<code class="markup--code markup--p-code">a</code>. Example, a Maybe type.</p><p name="687c" id="687c" class="graf graf--p graf-after--p"><code class="markup--code markup--p-code">Lens</code> represents optics where we can surely retrieve a value of type <code class="markup--code markup--p-code">a </code>from the structure <code class="markup--code markup--p-code">s</code>. Example, a Tuple</p><p name="200f" id="200f" class="graf graf--p graf-after--p"><code class="markup--code markup--p-code">Traversal</code> represents optics where we get zero or more values of type <code class="markup--code markup--p-code">a </code>from the structure <code class="markup--code markup--p-code">s</code>. Example, a Array</p><p name="3a2e" id="3a2e" class="graf graf--p graf-after--p"><code class="markup--code markup--p-code">Iso</code> represent optics where the structure <code class="markup--code markup--p-code">s</code> and value <code class="markup--code markup--p-code">a</code> are isomorphic to each other. Example, a newtype</p><pre name="b0f5" id="b0f5" class="graf graf--pre graf-after--p">newtype Name = Name String<br>// here `Name` and `String` are isomorphic to each other<br>// one of them are enough to create the other</pre><h4 name="fa2c" id="fa2c" class="graf graf--h4 graf-after--pre">Dissecting the¬†example</h4><pre name="6bbc" id="6bbc" class="graf graf--pre graf-after--h4">(_Just &lt;&lt;&lt; ix index &lt;&lt;&lt; _foo &lt;&lt;&lt; _2 &lt;&lt;&lt; _Right)</pre><ul class="postList"><li name="0bf4" id="0bf4" class="graf graf--li graf-after--pre">One of the powerful thing we can do with optics is composing them.</li><li name="1a90" id="1a90" class="graf graf--li graf-after--li">Optics are conventionally prefixed with an underscore and need to be read from left to right (when we left compose it).</li><li name="8ed9" id="8ed9" class="graf graf--li graf-after--li">As we move to the right we are going one layer deep into the structure. From the above optic, we can conclude that</li></ul><pre name="928e" id="928e" class="graf graf--pre graf-after--li">1st Layer - A Maybe<br>2nd Layer - Array like structure<br>3rd Layer - A Record<br>4th Layer - A tuple<br>5th Layer - An Either  </pre><p name="db08" id="db08" class="graf graf--p graf-after--pre">If your recall that‚Äôs what exactly our <code class="markup--code markup--p-code">NestedData</code> is,</p><pre name="dfae" id="dfae" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code">type NestedData =<br>  Maybe                      -- 1 : _Just<br>   (Array                    -- 2 : ix index<br>     { foo ::                -- 3 : _foo<br>        Tuple String         -- 4 : _2<br>        (Either Int Boolean) -- 5 : _Right<br>     , bar :: String })</code></pre><p name="3ee9" id="3ee9" class="graf graf--p graf-after--pre">Most of the above optics are predefined in the module <a href="https://pursuit.purescript.org/packages/purescript-profunctor-lenses/8.0.0" data-href="https://pursuit.purescript.org/packages/purescript-profunctor-lenses/8.0.0" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">profunctor-lens</a>, except <code class="markup--code markup--p-code">_foo</code> which is also quite easy to define.</p><pre name="d694" id="d694" class="graf graf--pre graf-after--p">import Data.Lens.Record(props) </pre><pre name="233b" id="233b" class="graf graf--pre graf-after--pre graf--trailing">_foo = prop (Proxy :: Proxy &quot;foo&quot;)</pre></div></div></section><section name="ca2f" class="section section--body"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="6653" id="6653" class="graf graf--h3 graf--leading">Diving deeep</h3><p name="4973" id="4973" class="graf graf--p graf-after--h3">Let‚Äôs understand one by one of the four optics,</p><h4 name="d0c0" id="d0c0" class="graf graf--h4 graf-after--p">1.Lenses</h4><p name="7e89" id="7e89" class="graf graf--p graf-after--h4">We use lenses for product types like Tuples and records. Lenses lets us get and modify a value of type <code class="markup--code markup--p-code">a</code> when it is sure to be present in the structure <code class="markup--code markup--p-code">s</code>¬†. Example the lens <code class="markup--code markup--p-code">_2</code> will fetch the second element of the tuple, which we are sure is always present in any given tuple.</p><pre name="ece5" id="ece5" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code">-- This lens focuses on the second element of a tuple and is implemented<br>-- in the Data.Lens.Lens.Tuple module.<br>_2 :: forall a b. Lens&#39; (Tuple a b) b<br><br>-- This lens focuses on the &quot;name&quot; field of a record; we have to construct<br>-- this one ourselves.<br>_name :: forall a r. Lens&#39; { name :: a | r } a<br>_name = prop (SProxy :: SProxy &quot;name&quot;)</code></pre><p name="bf29" id="bf29" class="graf graf--p graf-after--pre">You can use functions like <code class="markup--code markup--p-code">view</code>to get the value <code class="markup--code markup--p-code">a</code> from the struture <code class="markup--code markup--p-code">s</code> and use functions like <code class="markup--code markup--p-code">set</code> and <code class="markup--code markup--p-code">over</code>to modify the value in it.</p><p name="071e" id="071e" class="graf graf--p graf-after--p">Consider you have the type</p><pre name="9c27" id="9c27" class="graf graf--pre graf-after--p">type Person = {name :: String, age :: Int}</pre><p name="60fb" id="60fb" class="graf graf--p graf-after--pre">and you have created a lens that work on the field <code class="markup--code markup--p-code">name</code></p><pre name="debf" id="debf" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code">_name :: forall a r. Lens&#39; { name :: a | r } a<br>_name = prop (SProxy :: SProxy &quot;name&quot;)</code></pre><p name="4460" id="4460" class="graf graf--p graf-after--pre">If you want to get the <code class="markup--code markup--p-code">name</code> field‚Äôs value, you can use <code class="markup--code markup--p-code">view</code></p><pre name="35d9" id="35d9" class="graf graf--pre graf-after--p">&gt;&gt;&gt; view _name {name : &quot;Saravanan&quot;, age : &quot;22&quot;}</pre><p name="0082" id="0082" class="graf graf--p graf-after--pre">If you want to override the value, you can use <code class="markup--code markup--p-code">set</code></p><pre name="b052" id="b052" class="graf graf--pre graf-after--p">setName :: Person -&gt; Person<br>setName p = set _name &quot;Saravanan M&quot; p</pre><pre name="921f" id="921f" class="graf graf--pre graf-after--pre">&gt;&gt;&gt; setName {name : &quot;Saravanan&quot;, age : &quot;22&quot;}<br>&gt;&gt;&gt; {name : &quot;Saravanan M&quot;, age : &quot;22&quot;}</pre><p name="98c7" id="98c7" class="graf graf--p graf-after--pre">If you want to override the value with respect the previous value, then you can use <code class="markup--code markup--p-code">over</code></p><pre name="11ea" id="11ea" class="graf graf--pre graf-after--p">setName&#39; :: Person -&gt; Person<br>setName&#39; p = over _name (\name -&gt; &quot;Mr.&quot; &lt;&gt; name) p</pre><pre name="63c4" id="63c4" class="graf graf--pre graf-after--pre">&gt;&gt;&gt; setName&#39; {name : &quot;Saravanan&quot;, age : &quot;22&quot;}<br>&gt;&gt;&gt; {name : &quot;Mr.Saravanan&quot;, age : &quot;22&quot;}</pre><h4 name="2705" id="2705" class="graf graf--h4 graf-after--pre">2. Prism</h4><p name="fe81" id="fe81" class="graf graf--p graf-after--h4">Unlike Lenses, which work on Product types and always the structure <code class="markup--code markup--p-code">s</code> it works on has the value <code class="markup--code markup--p-code">a</code>¬†, Prisms works on Sum types(like Maybe, Either etc) and the structure <code class="markup--code markup--p-code">s</code> it works on may or may not have the value <code class="markup--code markup--p-code">a</code> it asks for.</p><p name="4271" id="4271" class="graf graf--p graf-after--p">Let‚Äôs suppose we are working on the type</p><pre name="6a23" id="6a23" class="graf graf--pre graf-after--p">type APIResponse = Either String Person</pre><p name="eaf1" id="eaf1" class="graf graf--p graf-after--pre">To get the left and right value you can use the predefined Prisms <code class="markup--code markup--p-code">Left</code> and <code class="markup--code markup--p-code">_Right</code> respectively.</p><pre name="30e9" id="30e9" class="graf graf--pre graf-after--p">getErrorResponse :: APIResponse -&gt; Maybe String<br>getErrorResponse  =  preview _Left </pre><pre name="deee" id="deee" class="graf graf--pre graf-after--pre">getSuccessResponse :: APIResponse -&gt; Maybe Person<br>getSuccessResponse = preview _Right</pre><pre name="e48a" id="e48a" class="graf graf--pre graf-after--pre">&gt;&gt;&gt; getErrorResponse (Left &quot;Failed&quot;)<br>&gt;&gt;&gt; Just &quot;Failed&quot;</pre><pre name="2aa9" id="2aa9" class="graf graf--pre graf-after--pre">&gt;&gt;&gt; getSuccessResponse (Left &quot;Failed&quot;)<br>&gt;&gt;&gt; Nothing</pre><blockquote name="d98d" id="d98d" class="graf graf--blockquote graf-after--pre">Note: The value returned from <strong class="markup--strong markup--blockquote-strong">preview</strong> is <strong class="markup--strong markup--blockquote-strong">Maybe a</strong> unlike <code class="markup--code markup--blockquote-code">view</code>which returns <code class="markup--code markup--blockquote-code">a</code></blockquote><p name="10ac" id="10ac" class="graf graf--p graf-after--blockquote graf--trailing">You can also use <code class="markup--code markup--p-code">over</code>¬†, <code class="markup--code markup--p-code">set</code> for Prism as used for Lens.</p></div></div></section><section name="b0c4" class="section section--body section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><p name="504e" id="504e" class="graf graf--p graf--leading">If you want to learn about the remaining optics Traversals, Iso, and also want to read more on this topic, I highly suggest you to read <a href="https://thomashoneyman.com/articles/practical-profunctor-lenses-optics/" data-href="https://thomashoneyman.com/articles/practical-profunctor-lenses-optics/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">this wonderful blog</a> by ThomasHoneyman.</p><p name="fd6f" id="fd6f" class="graf graf--p graf-after--p graf--trailing">I hope you‚Äôve liked the blog, Clap üëè¬†, share üë• if you‚Äôve found this helpful. I will see you with another awesome purescript module in the next article.</p></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@imsaravananm" class="p-author h-card">Saravanan M</a> on <a href="https://medium.com/p/89aba69405ef"><time class="dt-published" datetime="2022-10-05T03:49:14.767Z">October 5, 2022</time></a>.</p><p><a href="https://medium.com/@imsaravananm/profunctor-lens-exploring-purescript-modules-4-89aba69405ef" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on October 7, 2023.</p></footer></article></body></html>