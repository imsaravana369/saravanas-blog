<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Complete Guide to Encoding and Decoding in Purescript #Part-1</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">Complete Guide to Encoding and Decoding in Purescript #Part-1</h1>
</header>
<section data-field="subtitle" class="p-summary">
Basics of Encoding and Decoding in purescript.
</section>
<section data-field="body" class="e-content">
<section name="bab7" class="section section--body section--first"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="8159" id="8159" class="graf graf--h3 graf--leading graf--title">Complete Guide to Encoding and Decoding in Purescript #Part-1</h3><p name="e7fa" id="e7fa" class="graf graf--p graf-after--h3">While developing applications, most of the time we have to interact with outside world like making API requests, sending response, parsing configuration files etc.</p><p name="6b66" id="6b66" class="graf graf--p graf-after--p">In Purescript, we most of the time have to interact with javascript <a href="https://pursuit.purescript.org/packages/purescript-foreign/7.0.0/docs/Foreign#t:Foreign" data-href="https://pursuit.purescript.org/packages/purescript-foreign/7.0.0/docs/Foreign#t:Foreign" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Foreign</a> values and want to convert those values back to our local Purescript types and vice versa.</p><p name="2c36" id="2c36" class="graf graf--p graf-after--p">Encoding and Decoding let us do that in type safe way.</p><p name="08cb" id="08cb" class="graf graf--p graf-after--p">Since there are lot of topics we need to cover, I‚Äôm splitting them into 4 parts.</p><ol class="postList"><li name="b079" id="b079" class="graf graf--li graf-after--p">Basic Encoding and Decoding (this article)</li><li name="89b9" id="89b9" class="graf graf--li graf-after--li">Encoding/Decoding newtype and data</li><li name="1035" id="1035" class="graf graf--li graf-after--li">Encoding/Decoding Enums</li><li name="c704" id="c704" class="graf graf--li graf-after--li">Encoding/Decoding custom types.</li></ol><p name="c5ed" id="c5ed" class="graf graf--p graf-after--li">This part will be <strong class="markup--strong markup--p-strong">quite easy to grab</strong> as it will be teaching only the basics of Encoding and Decoding but it is very necessary to help you understand the next upcoming articles on Encoding/Decoding.</p><figure name="9d12" id="9d12" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*sINvS5C6Hb8SZBvK7lKNQA.jpeg" data-width="2400" data-height="1600" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/1*sINvS5C6Hb8SZBvK7lKNQA.jpeg"><figcaption class="imageCaption">Photo by <a href="https://unsplash.com/@robwicks?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" data-href="https://unsplash.com/@robwicks?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" class="markup--anchor markup--figure-anchor" rel="noopener" target="_blank">Rob Wicks</a> on¬†<a href="https://unsplash.com/s/photos/left-and-right?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" data-href="https://unsplash.com/s/photos/left-and-right?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" class="markup--anchor markup--figure-anchor" rel="noopener" target="_blank">Unsplash</a></figcaption></figure><h4 name="36a2" id="36a2" class="graf graf--h4 graf-after--figure">Basic Encoding and¬†Decoding</h4><p name="4a44" id="4a44" class="graf graf--p graf-after--h4">From Purescript point of view,</p><ul class="postList"><li name="4836" id="4836" class="graf graf--li graf-after--p">Encoding is a process of converting Purescript datatypes into JS foreign objects.</li><li name="8b10" id="8b10" class="graf graf--li graf-after--li">Decoding is the process of converting JS foreign objects back to their respective Purescript datatypes.</li></ul><p name="3646" id="3646" class="graf graf--p graf-after--li">To encode we will be using the function <code class="markup--code markup--p-code"><a href="https://pursuit.purescript.org/packages/purescript-foreign-generic/10.0.0/docs/Foreign.Generic.Class#v:encode" data-href="https://pursuit.purescript.org/packages/purescript-foreign-generic/10.0.0/docs/Foreign.Generic.Class#v:encode" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank"><strong class="markup--strong markup--p-strong">encode</strong></a></code> and to decode we will be using the function called <code class="markup--code markup--p-code"><a href="https://pursuit.purescript.org/packages/purescript-foreign-generic/10.0.0/docs/Foreign.Generic.Class#v:decode" data-href="https://pursuit.purescript.org/packages/purescript-foreign-generic/10.0.0/docs/Foreign.Generic.Class#v:decode" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank"><strong class="markup--strong markup--p-strong">decode</strong></a></code>¬†. As simple as it is.</p><p name="6423" id="6423" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">Question: Can we encode/decode any type?</strong></p><p name="474f" id="474f" class="graf graf--p graf-after--p"><em class="markup--em markup--p-em">No</em>!! For a type to be Encodable/Decodable it needs to implement the respective type classes <a href="https://pursuit.purescript.org/packages/purescript-foreign-generic/10.0.0/docs/Foreign.Generic.Class#t:Encode" data-href="https://pursuit.purescript.org/packages/purescript-foreign-generic/10.0.0/docs/Foreign.Generic.Class#t:Encode" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Encode</a> and <a href="https://pursuit.purescript.org/packages/purescript-foreign-generic/10.0.0/docs/Foreign.Generic.Class#t:Decode" data-href="https://pursuit.purescript.org/packages/purescript-foreign-generic/10.0.0/docs/Foreign.Generic.Class#t:Decode" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Decode</a> which are defined in <code class="markup--code markup--p-code"><a href="https://pursuit.purescript.org/packages/purescript-foreign-generic/10.0.0/docs/Foreign.Generic.Class" data-href="https://pursuit.purescript.org/packages/purescript-foreign-generic/10.0.0/docs/Foreign.Generic.Class" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Foreign.Generic.Class</a></code></p><pre name="7425" id="7425" class="graf graf--pre graf-after--p">class Encode a where  <br>   encode :: a -&gt; Foreign</pre><pre name="d1d2" id="d1d2" class="graf graf--pre graf-after--pre">class Decode a where  <br>   decode :: Foreign -&gt; F a</pre><p name="e21f" id="e21f" class="graf graf--p graf-after--pre"><strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em">Encode</em></strong>‚Ää‚Äî‚ÄäGiven a type <code class="markup--code markup--p-code">a</code>¬†, it knows how to convert that particular <code class="markup--code markup--p-code">a</code> to a <a href="https://pursuit.purescript.org/packages/purescript-foreign/7.0.0/docs/Foreign#t:Foreign" data-href="https://pursuit.purescript.org/packages/purescript-foreign/7.0.0/docs/Foreign#t:Foreign" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Foreign</a> (JS type)</p><p name="74d1" id="74d1" class="graf graf--p graf-after--p graf--trailing"><strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em">Decode</em></strong>‚Ää‚Äî‚ÄäGiven a Foreign, it knows how to convert it back to the Purescript type <code class="markup--code markup--p-code">a</code> (we will learn what that <code class="markup--code markup--p-code">F</code> means in the below section)</p></div></div></section><section name="6f69" class="section section--body"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><p name="84fd" id="84fd" class="graf graf--p graf--leading"><strong class="markup--strong markup--p-strong">Question: Do we need to define Encode and Decode all by ourselves?</strong></p><p name="40df" id="40df" class="graf graf--p graf-after--p">Most of the time it‚Äôs a No, because to make our lives easier the above module <code class="markup--code markup--p-code"><a href="https://pursuit.purescript.org/packages/purescript-foreign-generic/10.0.0/docs/Foreign.Generic.Class" data-href="https://pursuit.purescript.org/packages/purescript-foreign-generic/10.0.0/docs/Foreign.Generic.Class" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Foreign.Generic.Class</a></code> has defined Encode and Decode instances for lot of types like Int, String, Array, Maybe etc.</p><figure name="2740" id="2740" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*9LKqB-LUye_jsblU83_k_g.jpeg" data-width="2511" data-height="848" src="https://cdn-images-1.medium.com/max/800/1*9LKqB-LUye_jsblU83_k_g.jpeg"><figcaption class="imageCaption">Predefined Encode ande Decode instances</figcaption></figure><p name="117c" id="117c" class="graf graf--p graf-after--figure">The above image shows all the predefined Encode and Decode instances in <code class="markup--code markup--p-code"><a href="https://pursuit.purescript.org/packages/purescript-foreign-generic/10.0.0/docs/Foreign.Generic.Class" data-href="https://pursuit.purescript.org/packages/purescript-foreign-generic/10.0.0/docs/Foreign.Generic.Class" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Foreign.Generic.Class</a></code></p><p name="e967" id="e967" class="graf graf--p graf-after--p">In the other cases, the compiler will let us derive Encode and Decode instances for our custom defined types without writing lot of code (Part-2 will cover this)</p><blockquote name="a91e" id="a91e" class="graf graf--blockquote graf-after--p graf--trailing">Note: <strong class="markup--strong markup--blockquote-strong">Part-4</strong> of this series will show how we can define our own Encode and Decode instances by ourselves as it will be needed in some scenarios.</blockquote></div></div></section><section name="fc87" class="section section--body"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="6a9e" id="6a9e" class="graf graf--h3 graf--leading">Hands On</h3><p name="948e" id="948e" class="graf graf--p graf-after--h3">Now let‚Äôs look at how we can use those two functions <code class="markup--code markup--p-code">encode</code> and <code class="markup--code markup--p-code">decode</code> in practise.</p><h4 name="eeb6" id="eeb6" class="graf graf--h4 graf-after--p">Let‚Äôs Decode</h4><p name="dcb1" id="dcb1" class="graf graf--p graf-after--h4">Consider we have the below JS object in <code class="markup--code markup--p-code">Main.js</code>,</p><figure name="e671" id="e671" class="graf graf--figure graf--iframe graf-after--p"><script src="https://gist.github.com/imsaravana369/2da4f69bc7e422e6119e8ee6c6c88faa.js"></script></figure><p name="e5ab" id="e5ab" class="graf graf--p graf-after--figure">In <code class="markup--code markup--p-code">Main.purs</code>,</p><figure name="ea4f" id="ea4f" class="graf graf--figure graf--iframe graf-after--p"><script src="https://gist.github.com/imsaravana369/09d2157af4aeeb04c90eba5312e08a15.js"></script></figure><p name="3dec" id="3dec" class="graf graf--p graf-after--figure">In <code class="markup--code markup--p-code"><a href="https://github.com/purescript/spago" data-href="https://github.com/purescript/spago" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">spago repl</a></code> (Interactive way to run purescript programs)</p><figure name="1ecc" id="1ecc" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*7KqOD14kih2KMPDohX6YOg.png" data-width="2390" data-height="290" src="https://cdn-images-1.medium.com/max/800/1*7KqOD14kih2KMPDohX6YOg.png"><figcaption class="imageCaption">Decoding JS object to Purescript type</figcaption></figure><p name="b1af" id="b1af" class="graf graf--p graf-after--figure">As you can see, the above conversion is very intuitive, we have mapped all the value from the passed JS object to their respective Purescript type.</p><blockquote name="e30b" id="e30b" class="graf graf--blockquote graf-after--p"><em class="markup--em markup--blockquote-em">Note:</em> See how <code class="markup--code markup--blockquote-code"><strong class="markup--strong markup--blockquote-strong">partner¬†: null</strong></code><strong class="markup--strong markup--blockquote-strong"> </strong>is mapped to <code class="markup--code markup--blockquote-code"><strong class="markup--strong markup--blockquote-strong">partner¬†: Nothing</strong></code></blockquote><blockquote name="0b0c" id="0b0c" class="graf graf--blockquote graf-after--blockquote">All the Maybe fields are <strong class="markup--strong markup--blockquote-strong">optional</strong>, it means we can skip passing those values.</blockquote><p name="f3c7" id="f3c7" class="graf graf--p graf-after--blockquote">If I change, <code class="markup--code markup--p-code">partner¬†: Jane Doe</code> in Main.js,</p><figure name="74da" id="74da" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*Z2_2MJPcYGwU7E5esm_99w.png" data-width="2314" data-height="288" src="https://cdn-images-1.medium.com/max/800/1*Z2_2MJPcYGwU7E5esm_99w.png"></figure><p name="3585" id="3585" class="graf graf--p graf-after--figure">Now see, partner is now <code class="markup--code markup--p-code"><strong class="markup--strong markup--p-strong">Just &quot;Jane Doe&quot;</strong></code></p><p name="8bd1" id="8bd1" class="graf graf--p graf-after--p">If we pass even a single invalid field from foreign, it will make the whole decode operation fail, for example, if I change <code class="markup--code markup--p-code">gender¬†: ‚ÄòM‚Äô</code> to <code class="markup--code markup--p-code">gender¬†: &quot;Male&quot;</code> it will fail as gender is a <code class="markup--code markup--p-code">Char</code> but we are passing a <code class="markup--code markup--p-code">String</code></p><figure name="c662" id="c662" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*zmodXryXq_TNw-e7TLNFjg.png" data-width="2320" data-height="282" src="https://cdn-images-1.medium.com/max/800/1*zmodXryXq_TNw-e7TLNFjg.png"><figcaption class="imageCaption">Decode failed, when we passed String instead of Char for gender¬†field</figcaption></figure><p name="eb9b" id="eb9b" class="graf graf--p graf-after--figure">The error would be,</p><pre name="8942" id="8942" class="graf graf--pre graf-after--p graf--trailing">(NonEmptyList <br>  (NonEmpty <br>    (<strong class="markup--strong markup--pre-strong">ErrorAtProperty ‚Äúgender‚Äù (TypeMismatch ‚ÄúChar‚Äù ‚ÄúString‚Äù)</strong>)<br>  Nil))</pre></div></div></section><section name="25b2" class="section section--body"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h4 name="a17f" id="a17f" class="graf graf--h4 graf--leading">Working of ‚Äú<strong class="markup--strong markup--h4-strong">runExcept $ decode¬†fgn‚Äù</strong></h4><p name="fce0" id="fce0" class="graf graf--p graf-after--h4">You can skip this section if you find it hard, it will explain how we are using the <code class="markup--code markup--p-code">decode</code> function to get <code class="markup--code markup--p-code">Either</code> out of it.</p><p name="6abe" id="6abe" class="graf graf--p graf-after--p">Okay, having seen how decode works, some of you might be confused with the line,</p><pre name="9e67" id="9e67" class="graf graf--pre graf-after--p">decodePerson :: Foreign -&gt; Maybe Person <br>decodePerson fgn = case <strong class="markup--strong markup--pre-strong">runExcept $ decode fgn </strong>of       <br>     Right person -&gt; Just person      <br>     Left err -&gt; Nothing</pre><p name="452a" id="452a" class="graf graf--p graf-after--pre">what Exactly are we doing using, <code class="markup--code markup--p-code">runExcept $ decode fgn</code>¬†??</p><p name="3938" id="3938" class="graf graf--p graf-after--p">If you look at the type of decode and runExcept</p><pre name="df5d" id="df5d" class="graf graf--pre graf-after--p">---  decode :: Foreign -&gt; F a<br> <br><strong class="markup--strong markup--pre-strong">decode</strong> :: Foreign -&gt; Except (NonEmptyList ForeignError) a</pre><pre name="0700" id="0700" class="graf graf--pre graf-after--pre"><code class="markup--code markup--pre-code u-paddingRight0 u-marginRight0"><strong class="markup--strong markup--pre-strong">runExcept</strong> :: forall e a. Except e a -&gt; Either e a</code></pre><blockquote name="a324" id="a324" class="graf graf--blockquote graf-after--pre">Note: type F = Except (NonEmptyList ForeignError)</blockquote><p name="15f0" id="15f0" class="graf graf--p graf-after--blockquote">Calling decode wont give us back the decoded value, it will give an <code class="markup--code markup--p-code">Except</code> monad which wraps the result or an Error that occurred while decoding.</p><p name="2ae7" id="2ae7" class="graf graf--p graf-after--p graf--trailing">To get <code class="markup--code markup--p-code">Either</code> out of <code class="markup--code markup--p-code">Except</code> (so that we could pattern match and pull the value out ) we need to use <code class="markup--code markup--p-code">runExcept</code> which has the ability to convert <code class="markup--code markup--p-code">Except e a</code> to <code class="markup--code markup--p-code">Either e a</code></p></div></div></section><section name="3a89" class="section section--body section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h4 name="915f" id="915f" class="graf graf--h4 graf--leading"><strong class="markup--strong markup--h4-strong">Encode</strong></h4><p name="8fb4" id="8fb4" class="graf graf--p graf-after--h4">Encode is far simpler to grasp than decode. All you have to do is to call <code class="markup--code markup--p-code">encode</code> function, that‚Äôs all, no need for runExcept, Error handling.</p><pre name="dab1" id="dab1" class="graf graf--pre graf-after--p">person ::Person<br>person =  <br>  { name : &quot;John Doe&quot;<br>  , age : 21<br>  , degrees : [&quot;BE&quot;,&quot;MBA&quot;]<br>  , gender : &#39;M&#39;<br>  , isMarried : false<br>  , partner : Nothing<br>  }</pre><p name="2a1a" id="2a1a" class="graf graf--p graf-after--pre">If you do,</p><pre name="282d" id="282d" class="graf graf--pre graf-after--p">&gt;&gt;&gt; encode person</pre><blockquote name="8040" id="8040" class="graf graf--blockquote graf-after--pre">Note: We can‚Äôt print Foreign in <code class="markup--code markup--blockquote-code">repl</code>, as it doesn‚Äôt have any Show Instance</blockquote><p name="0a85" id="0a85" class="graf graf--p graf-after--blockquote">You will get,</p><pre name="38b6" id="38b6" class="graf graf--pre graf-after--p">{<br> partner: null,<br> name: ‚ÄòJohn Doe‚Äô,<br> isMarried: false,<br> gender: ‚ÄòM‚Äô,<br> degrees: [ ‚ÄòBE‚Äô, ‚ÄòMBA‚Äô ],<br> age: 21<br>}</pre><p name="ef57" id="ef57" class="graf graf--p graf-after--pre">Exactly the same as the one in <code class="markup--code markup--p-code">Main.js</code>¬†, so if you do encode followed by a decode you will arrive at the same type and it also holds vice versa(on successfully encoding/decoding)</p><h4 name="029f" id="029f" class="graf graf--h4 graf-after--p">Bonus:</h4><p name="b114" id="b114" class="graf graf--p graf-after--h4">If you really want to see the encode result, use <code class="markup--code markup--p-code"><a href="https://pursuit.purescript.org/packages/purescript-debug/6.0.2/docs/Debug#v:spy" data-href="https://pursuit.purescript.org/packages/purescript-debug/6.0.2/docs/Debug#v:spy" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">spy</a></code> from <a href="https://pursuit.purescript.org/packages/purescript-debug/6.0.2/docs/Debug#v:spy" data-href="https://pursuit.purescript.org/packages/purescript-debug/6.0.2/docs/Debug#v:spy" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Debug.Trace</a> which can print any value, even those without show instance.</p><pre name="668b" id="668b" class="graf graf--pre graf-after--p">main :: Effect Unit<br>main = do<br>  let _ =  spy &quot;Encode result&quot; $ encode person<br>  pure unit</pre><figure name="6501" id="6501" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="1*Bsi_SRymfMSeRG7kGDP5FA.png" data-width="1980" data-height="526" src="https://cdn-images-1.medium.com/max/800/1*Bsi_SRymfMSeRG7kGDP5FA.png"><figcaption class="imageCaption">spago repl</figcaption></figure><p name="f34d" id="f34d" class="graf graf--p graf-after--figure">Hope you‚Äôve learnt about basic encoding and decoding in this article, in the next article we will see how to do Encoding/Decoding of new types and ADTs.</p><p name="227f" id="227f" class="graf graf--p graf-after--p graf--trailing">Clapüëè if you‚Äôve liked this article and don‚Äôt forget to try out the examples by yourself.</p></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@imsaravananm" class="p-author h-card">Saravanan M</a> on <a href="https://medium.com/p/b95f81bb9eb5"><time class="dt-published" datetime="2022-10-22T15:49:17.242Z">October 22, 2022</time></a>.</p><p><a href="https://medium.com/@imsaravananm/complete-guide-to-encoding-and-decoding-in-purescript-part-1-b95f81bb9eb5" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on October 7, 2023.</p></footer></article></body></html>