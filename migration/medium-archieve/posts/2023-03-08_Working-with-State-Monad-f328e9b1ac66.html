<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Working with State Monad</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">Working with State Monad</h1>
</header>
<section data-field="subtitle" class="p-summary">
Want to get super power? Learn how to mutate variables at will.
</section>
<section data-field="body" class="e-content">
<section name="dcaf" class="section section--body section--first"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="cd3f" id="cd3f" class="graf graf--h3 graf--leading graf--title">State Monadâ€Šâ€”â€ŠPurescript</h3><p name="588f" id="588f" class="graf graf--p graf-after--h3">We know every data in purescript is immutable. So everytime we want to mutate a value, we have to create a new variable and store the value in the newly created variable and use that new variable, and global variables seems like an impossible thing to attain.</p><p name="386c" id="386c" class="graf graf--p graf-after--p">What if I tell you, thereâ€™s a Monad which let you store values globally and also make mutation on the global state possible?</p><p name="66a9" id="66a9" class="graf graf--p graf-after--p">Yes, in this article we are going to see about <code class="markup--code markup--p-code"><a href="https://pursuit.purescript.org/packages/purescript-transformers/6.0.0/docs/Control.Monad.State#t:State" data-href="https://pursuit.purescript.org/packages/purescript-transformers/6.0.0/docs/Control.Monad.State#t:State" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">State</a></code> monad, one of the most widely used Monads that lets functional programming solve actual real world problems.</p><figure name="de29" id="de29" class="graf graf--figure graf-after--p graf--trailing"><img class="graf-image" data-image-id="1*jf9kuTASzzNvF_bwONzqQA.jpeg" data-width="4288" data-height="2848" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/1*jf9kuTASzzNvF_bwONzqQA.jpeg"><figcaption class="imageCaption">Photo by <a href="https://unsplash.com/@scw1217?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" data-href="https://unsplash.com/@scw1217?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" class="markup--anchor markup--figure-anchor" rel="noopener" target="_blank">Suzanne D. Williams</a> onÂ <a href="https://unsplash.com/photos/VMKBFR6r_jg?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" data-href="https://unsplash.com/photos/VMKBFR6r_jg?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" class="markup--anchor markup--figure-anchor" rel="noopener" target="_blank">Unsplash</a></figcaption></figure></div></div></section><section name="1e6d" class="section section--body"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><p name="e5d6" id="e5d6" class="graf graf--p graf--leading">For understanding State Monad, letâ€™s create a small <em class="markup--em markup--p-em">trivial</em> game.</p><p name="58d1" id="58d1" class="graf graf--p graf-after--p">This game will be based on 1 vs 1 fighting sort of game, (but donâ€™t except graphics and allðŸ˜‚).</p><h4 name="6884" id="6884" class="graf graf--h4 graf-after--p">Deciding theÂ State</h4><p name="d60e" id="d60e" class="graf graf--p graf-after--h4">For using State Monad, first we have to decide the type of the state we want to work on.</p><p name="b673" id="b673" class="graf graf--p graf-after--p">For my game, I have decided that my game state will look like the below,</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="kotlin" name="d939" id="d939" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content">type GameState = { enemyLife :: <span class="hljs-built_in">Int</span><br />                 , myLife    :: <span class="hljs-built_in">Int</span> <br />                 , myChance  :: <span class="hljs-built_in">Boolean</span> <br />                 }  </span></pre><p name="f33f" id="f33f" class="graf graf--p graf-after--pre">where <code class="markup--code markup--p-code">enemyLife, myLife</code> indicates the life left for enemy and my avatar respectively. <code class="markup--code markup--p-code">myChance</code> tells which player chance is to attack.</p><h4 name="2d8d" id="2d8d" class="graf graf--h4 graf-after--p">Operations onÂ State</h4><p name="c2d7" id="c2d7" class="graf graf--p graf-after--h4">Before writing the loop, letâ€™s look at some operation that you can do with State Monad. Assuming the state we are working on is <code class="markup--code markup--p-code">GameState</code> defined above,</p><h4 name="30d4" id="30d4" class="graf graf--h4 graf-after--p"><strong class="markup--strong markup--h4-strong">1. getâ€Šâ€”â€Š<em class="markup--em markup--h4-em">Get the currentÂ state</em></strong></h4><figure name="2669" id="2669" class="graf graf--figure graf-after--h4"><img class="graf-image" data-image-id="1*VCaXWFQc-QvVjyDz3MWJwQ.png" data-width="1350" data-height="340" src="https://cdn-images-1.medium.com/max/800/1*VCaXWFQc-QvVjyDz3MWJwQ.png"></figure><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="csharp" name="adaa" id="adaa" class="graf graf--pre graf-after--figure graf--trailing graf--preV2"><span class="pre--content">{enemyLife, myLife, myChance} &lt;- <span class="hljs-keyword">get</span></span></pre></div></div></section><section name="125d" class="section section--body"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h4 name="81b1" id="81b1" class="graf graf--h4 graf--leading">2. <strong class="markup--strong markup--h4-strong">putâ€Šâ€”â€Š</strong><em class="markup--em markup--h4-em">Overide the current stateÂ fully</em></h4><figure name="c22a" id="c22a" class="graf graf--figure graf-after--h4"><img class="graf-image" data-image-id="1*4ZLGnBgq6dHUaLgTM38LzA.png" data-width="1356" data-height="314" src="https://cdn-images-1.medium.com/max/800/1*4ZLGnBgq6dHUaLgTM38LzA.png"></figure><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="yaml" name="8678" id="8678" class="graf graf--pre graf-after--figure graf--trailing graf--preV2"><span class="pre--content"><span class="hljs-string">put</span> {<span class="hljs-attr">enemyLife :</span> <span class="hljs-number">100</span>, <span class="hljs-attr">myLife :</span> <span class="hljs-number">200</span>, <span class="hljs-attr">myChance :</span> <span class="hljs-literal">false</span>}</span></pre></div></div></section><section name="387e" class="section section--body"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h4 name="38d3" id="38d3" class="graf graf--h4 graf--leading"><strong class="markup--strong markup--h4-strong">3. modify</strong></h4><p name="d136" id="d136" class="graf graf--p graf-after--h4"><strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em">Modify the state with a function and return the new state back.</em></strong></p><figure name="2c22" id="2c22" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*w3ud47IMCErUDLO6Fx1aSQ.png" data-width="1336" data-height="378" src="https://cdn-images-1.medium.com/max/800/1*w3ud47IMCErUDLO6Fx1aSQ.png"></figure><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="rust" name="9053" id="9053" class="graf graf--pre graf-after--figure graf--preV2"><span class="pre--content">newState &lt;- <span class="hljs-title function_ invoke__">modify</span> (\s <span class="hljs-punctuation">-&gt;</span> s{myChance = <span class="hljs-literal">false</span>}) </span></pre><p name="e02b" id="e02b" class="graf graf--p graf-after--pre">Thereâ€™s another version of modify called <code class="markup--code markup--p-code"><a href="https://pursuit.purescript.org/packages/purescript-transformers/6.0.0/docs/Control.Monad.State.Class#v:modify_" data-href="https://pursuit.purescript.org/packages/purescript-transformers/6.0.0/docs/Control.Monad.State.Class#v:modify_" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">modify_</a></code> which works exactly like <code class="markup--code markup--p-code">modify</code> but returns unit, instead of the new state.</p><h4 name="354d" id="354d" class="graf graf--h4 graf-after--p">4. <strong class="markup--strong markup--h4-strong">gets</strong></h4><p name="7fd0" id="7fd0" class="graf graf--p graf-after--h4">Same as <code class="markup--code markup--p-code">get</code>, but apply some function to the state then return the result of the function.</p><p name="d906" id="d906" class="graf graf--p graf-after--p">Helpful in getting a particular field from the state.</p><figure name="7ec1" id="7ec1" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*b6PxptvcXMQFtK-UVJE11A.png" data-width="1338" data-height="344" src="https://cdn-images-1.medium.com/max/800/1*b6PxptvcXMQFtK-UVJE11A.png"></figure><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="r" name="67d2" id="67d2" class="graf graf--pre graf-after--figure graf--trailing graf--preV2"><span class="pre--content">isMyChance <span class="hljs-operator">&lt;-</span> gets <span class="hljs-punctuation">(</span>_.myChance<span class="hljs-punctuation">)</span> <br /><br />isGameOver <span class="hljs-operator">&lt;-</span> gets <span class="hljs-punctuation">(</span><span class="hljs-punctuation">\</span>s <span class="hljs-operator">-&gt;</span> s.myLife <span class="hljs-operator">&lt;=</span><span class="hljs-number">0</span> <span class="hljs-operator">||</span> s.enemyLife <span class="hljs-operator">&lt;=</span> <span class="hljs-number">0</span><span class="hljs-punctuation">)</span></span></pre></div></div></section><section name="4580" class="section section--body"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h4 name="2356" id="2356" class="graf graf--h4 graf--leading">Back to ourÂ game</h4><p name="1e4b" id="1e4b" class="graf graf--p graf-after--h4">We know that every game has a game loop which keeps on executing until the game ends. Similarly our game also has a game loop which ends when one of the players life is over.</p><p name="c7e3" id="c7e3" class="graf graf--p graf-after--p">Iâ€™m very much accustomed to importing State as qualified import, its helpful in preventing name conflicts.</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="javascript" name="c4fc" id="c4fc" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Control</span>.<span class="hljs-property">Monad</span>.<span class="hljs-property">State</span> <span class="hljs-keyword">as</span> S</span></pre><p name="fcbc" id="fcbc" class="graf graf--p graf-after--pre">The initial version of game will be very boring, like everytime the players attack one another they incur the same damage.</p><p name="93df" id="93df" class="graf graf--p graf-after--p">Later we can make it more randomized with random function.</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="rust" name="af01" id="af01" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content">game :: S.State GameState Unit<br />game = <span class="hljs-keyword">do</span> <br />    gameOver &lt;- S.<span class="hljs-title function_ invoke__">gets</span> (\s <span class="hljs-punctuation">-&gt;</span> s.enemyLife &lt;=<span class="hljs-number">0</span> || s.myLife &lt;=<span class="hljs-number">0</span>)<br />    <span class="hljs-title function_ invoke__">when</span> (not gameOver) <span class="hljs-keyword">do</span><br />          {myChance} &lt;- S.get<br />          <span class="hljs-keyword">let</span> <span class="hljs-variable">damage</span> = <span class="hljs-number">1</span><br />          <span class="hljs-keyword">if</span> myChance <br />             then S.modify_ \s <span class="hljs-punctuation">-&gt;</span> s { enemyLife = s.enemyLife - damage }<br />             <span class="hljs-keyword">else</span> S.modify_ \s <span class="hljs-punctuation">-&gt;</span> s { myLife    = s.myLife - damage }<br />          S.modify_ \s <span class="hljs-punctuation">-&gt;</span> s {myChance = not s.myChance}<br />          game</span></pre><p name="7b8e" id="7b8e" class="graf graf--p graf-after--pre">The above code is very easy to read if youâ€™re following along, let me break it line by line</p><ol class="postList"><li name="9115" id="9115" class="graf graf--li graf-after--p">Type of our function <code class="markup--code markup--li-code">gameÂ :: S.State GameState Unit</code></li></ol><p name="02d7" id="02d7" class="graf graf--p graf-after--li">The type of our function states that our state monad operates on the state <code class="markup--code markup--p-code">GameState</code> and will return <code class="markup--code markup--p-code">Unit</code> (it wonâ€™t return anything meaningful)</p><p name="527c" id="527c" class="graf graf--p graf-after--p">2. <strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em">gameOver</em></strong>â€Šâ€”â€ŠWill become true when one of the playerâ€™s life goes below 0, from which we decide whether to exit the game or not.</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="r" name="a535" id="a535" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content">gameOver <span class="hljs-operator">&lt;-</span> S.gets <span class="hljs-punctuation">(</span><span class="hljs-punctuation">\</span>s <span class="hljs-operator">-&gt;</span> s.enemyLife <span class="hljs-operator">&lt;=</span><span class="hljs-number">0</span> <span class="hljs-operator">||</span> s.myLife <span class="hljs-operator">&lt;=</span><span class="hljs-number">0</span><span class="hljs-punctuation">)</span></span></pre><p name="f4f8" id="f4f8" class="graf graf--p graf-after--pre">3. We loop only when the <code class="markup--code markup--p-code">gameOver</code> variable is false.</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="csharp" name="4700" id="4700" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">when</span> (<span class="hljs-keyword">not</span> gameOver) <span class="hljs-keyword">do</span><br />      .....</span></pre><p name="0e02" id="0e02" class="graf graf--p graf-after--pre">4. Then we are restructuring the <code class="markup--code markup--p-code">GameState</code> and only getting the <code class="markup--code markup--p-code">myChance</code> field. It is also possible with <code class="markup--code markup--p-code">gets</code> function.</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="r" name="333d" id="333d" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content">isMyChance <span class="hljs-operator">&lt;-</span> H.gets <span class="hljs-punctuation">(</span>_.myChance<span class="hljs-punctuation">)</span> </span></pre><p name="345b" id="345b" class="graf graf--p graf-after--pre">5. According to whose chance it is, the other player loses 1 life point.</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="rust" name="296c" id="296c" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">if</span> myChance <br />   then S.modify_ \s <span class="hljs-punctuation">-&gt;</span> s { enemyLife = s.enemyLife - damage }<br />   <span class="hljs-keyword">else</span> S.modify_ \s <span class="hljs-punctuation">-&gt;</span> s { myLife    = s.myLife - damage }</span></pre><p name="91ae" id="91ae" class="graf graf--p graf-after--pre">6. Then we are giving the chance to the next player.</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="rust" name="2768" id="2768" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content">S.modify_ \s <span class="hljs-punctuation">-&gt;</span> s {myChance = not s.myChance}</span></pre><p name="df3d" id="df3d" class="graf graf--p graf-after--pre graf--trailing">7. Then we loop gain by calling <code class="markup--code markup--p-code">game</code> recursively.</p></div></div></section><section name="932d" class="section section--body"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h4 name="edc9" id="edc9" class="graf graf--h4 graf--leading">How to run ourÂ game?</h4><p name="b49d" id="b49d" class="graf graf--p graf-after--h4">But how can we execute our <code class="markup--code markup--p-code">game</code> function? Where are we passing the initial State?</p><p name="3d3b" id="3d3b" class="graf graf--p graf-after--p">There are several function with which we can run a State Monad, all of them work the same but the result they yield differs.</p><figure name="2d77" id="2d77" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*hu7cME-3apX_mUlfmsTMjw.png" data-width="1350" data-height="970" src="https://cdn-images-1.medium.com/max/800/1*hu7cME-3apX_mUlfmsTMjw.png"></figure><ul class="postList"><li name="5b60" id="5b60" class="graf graf--li graf-after--figure"><strong class="markup--strong markup--li-strong"><em class="markup--em markup--li-em">runState</em></strong>â€Šâ€”â€Šreturns both the result <code class="markup--code markup--li-code">a</code> and final State <code class="markup--code markup--li-code">s</code> as a Tuple</li><li name="fb0a" id="fb0a" class="graf graf--li graf-after--li"><strong class="markup--strong markup--li-strong"><em class="markup--em markup--li-em">evalState</em></strong>â€Šâ€”â€Šreturns only the result (Unit in our case)</li><li name="33b3" id="33b3" class="graf graf--li graf-after--li"><strong class="markup--strong markup--li-strong"><em class="markup--em markup--li-em">execState</em></strong>â€Šâ€”â€Šreturns the final State</li></ul><p name="9ff0" id="9ff0" class="graf graf--p graf-after--li">So again, how can we run our <code class="markup--code markup--p-code">game</code> function? My function returns <code class="markup--code markup--p-code">Unit</code> with which I canâ€™t do anything, so I will get the final state and decide the winner from it (whoever has some life left wins)</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="java" name="e20a" id="e20a" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">module</span> Main where<br /><span class="hljs-keyword">import</span> <span class="hljs-title function_">Effect</span><span class="hljs-params">(Effect)</span><br /><span class="hljs-keyword">import</span> Effect.Console(log) as Console<br /><br />main :: Effect <span class="hljs-type">Unit</span><br /><span class="hljs-variable">main</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">do</span> <br />   <span class="hljs-type">let</span> <span class="hljs-variable">initialState</span> <span class="hljs-operator">=</span> {enemyLife : <span class="hljs-number">100</span>, myLife : <span class="hljs-number">100</span>, myChance : <span class="hljs-literal">true</span>}<br />   let { myLife} = S.execState game initialState<br />   Console.log $ <span class="hljs-keyword">if</span> myLife &gt; <span class="hljs-number">0</span> then <span class="hljs-string">&quot;I Won&quot;</span> <span class="hljs-keyword">else</span> <span class="hljs-string">&quot;I Lost&quot;</span></span></pre><p name="dc6c" id="dc6c" class="graf graf--p graf-after--pre graf--trailing">This is how I can run my state monad. You can try it out <a href="https://try.purescript.org/?code=LYewJgrgNgpgBAWQIYEsB2cDuALGAnGAKEJWAAcQ8AXOABQKgjCJPMpoBEkqkA6AMRBQwSAEaw4ACgBmQsAEpWFanACi06TADGNSes07FpZTQAqeAJ60IBAMpa8KMruwBGADRwqMAB5VPBGjMeEZsKgDCIGhUeEK8CFFIYLy2PN5wSADOcLbEVBZk8ADiSMAwqdzwALxwAN5wMGgwwBYAMiiacABcXXAAktGeLe2dPf3RcEMW4dhIaFrwYwBCIEIwc3BwAL7EhADmpYu9tilpxYcV6QCqaChU%2B4dwNWAgcISbmwdlAPIAbvhwAA8AFocrw9jAqNlJAAdbLAgB8cEyvEazTaHXggKqAAY4AAffHI3jDTFA3GKD5YXAYSRoEA0L4wP74eRwF7vKlc2otGZzBZbIGgk4Q%2B5crmwGgiYBICFPOCuTnizYdOC82bzeBK5UfKg0sGgMAdCwAfTgcLgiORdQaTVJnRqKLR9vgoOlspgOx1XJgUEy8BOhuNZotVuy9RdVMdJIxnTdpQ92214sD4GD5vhSMyPOmGoW8vpNBR6v5nuTXKZ2qrMvQ3V6%2Bm0NBud0INYwz1enMlNpdgpqJ182ku8CZdWdscWcAAzFMRpOZ2rc6Xul48BAy5tu5govLVZGkXi9Y04AAiPpwADqURPDT98DPcFaIEyVBPnMCwTgABI4LJhNqAG04DcKRvD8LAonkABdIA" data-href="https://try.purescript.org/?code=LYewJgrgNgpgBAWQIYEsB2cDuALGAnGAKEJWAAcQ8AXOABQKgjCJPMpoBEkqkA6AMRBQwSAEaw4ACgBmQsAEpWFanACi06TADGNSes07FpZTQAqeAJ60IBAMpa8KMruwBGADRwqMAB5VPBGjMeEZsKgDCIGhUeEK8CFFIYLy2PN5wSADOcLbEVBZk8ADiSMAwqdzwALxwAN5wMGgwwBYAMiiacABcXXAAktGeLe2dPf3RcEMW4dhIaFrwYwBCIEIwc3BwAL7EhADmpYu9tilpxYcV6QCqaChU%2B4dwNWAgcISbmwdlAPIAbvhwAA8AFocrw9jAqNlJAAdbLAgB8cEyvEazTaHXggKqAAY4AAffHI3jDTFA3GKD5YXAYSRoEA0L4wP74eRwF7vKlc2otGZzBZbIGgk4Q%2B5crmwGgiYBICFPOCuTnizYdOC82bzeBK5UfKg0sGgMAdCwAfTgcLgiORdQaTVJnRqKLR9vgoOlspgOx1XJgUEy8BOhuNZotVuy9RdVMdJIxnTdpQ92214sD4GD5vhSMyPOmGoW8vpNBR6v5nuTXKZ2qrMvQ3V6%2Bm0NBud0INYwz1enMlNpdgpqJ182ku8CZdWdscWcAAzFMRpOZ2rc6Xul48BAy5tu5govLVZGkXi9Y04AAiPpwADqURPDT98DPcFaIEyVBPnMCwTgABI4LJhNqAG04DcKRvD8LAonkABdIA" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">here</a>.</p></div></div></section><section name="ef3a" class="section section--body"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><p name="64ed" id="64ed" class="graf graf--p graf--leading">But my game is very trivial and boring. The <code class="markup--code markup--p-code">myChance</code> variable decides the winner, if I get the first chance I win or I loose. (or the person having more life wins)</p><p name="c79c" id="c79c" class="graf graf--p graf-after--p">How can I add more salt and pepper to it?</p><p name="0285" id="0285" class="graf graf--p graf-after--p">If I add some randomization to my game, I feel that it would make it more interesting. But how can I do that?</p><p name="16e6" id="16e6" class="graf graf--p graf-after--p">I can use the <code class="markup--code markup--p-code"><a href="https://pursuit.purescript.org/packages/purescript-random/6.0.0/docs/Effect.Random#v:random" data-href="https://pursuit.purescript.org/packages/purescript-random/6.0.0/docs/Effect.Random#v:random" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">randomInt</a></code> function from <code class="markup--code markup--p-code">Effect.Random</code> to make the damage incured by players different in each iteration.</p><figure name="1b60" id="1b60" class="graf graf--figure graf-after--p graf--trailing"><img class="graf-image" data-image-id="1*EFK4Gl_pdb6qaLFB-5rHKw.png" data-width="1344" data-height="684" src="https://cdn-images-1.medium.com/max/800/1*EFK4Gl_pdb6qaLFB-5rHKw.png"></figure></div></div></section><section name="f5c5" class="section section--body"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h4 name="4b2d" id="4b2d" class="graf graf--h4 graf--leading">Adding Effect toÂ State</h4><p name="6cce" id="6cce" class="graf graf--p graf-after--h4">I will be replacing the line</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="bash" name="1dad" id="1dad" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-built_in">let</span> damage = 1 </span></pre><p name="c897" id="c897" class="graf graf--p graf-after--pre">with</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="r" name="73bc" id="73bc" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content">damage <span class="hljs-operator">&lt;-</span> randomInt <span class="hljs-number">1</span> <span class="hljs-number">10</span></span></pre><p name="f0ce" id="f0ce" class="graf graf--p graf-after--pre">But compiler will throw an error telling that I canâ€™t use <code class="markup--code markup--p-code">Effect</code> inside <code class="markup--code markup--p-code">State</code></p><p name="a550" id="a550" class="graf graf--p graf-after--p">Does it sounds like an end to our fantasy? Canâ€™t we make our game better? Why State Monad is so restrictive that itâ€™s not letting us use any monad inside it?</p><p name="3580" id="3580" class="graf graf--p graf-after--p">Wait, wait, wait.</p><p name="1ab5" id="1ab5" class="graf graf--p graf-after--p">Thereâ€™s a way. We have been using <code class="markup--code markup--p-code">State</code> monad but there a more generic version of State monad which is <code class="markup--code markup--p-code"><a href="https://pursuit.purescript.org/packages/purescript-transformers/6.0.0/docs/Control.Monad.State.Trans#t:StateT" data-href="https://pursuit.purescript.org/packages/purescript-transformers/6.0.0/docs/Control.Monad.State.Trans#t:StateT" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">StateT</a></code> with which we can achieve whatever we are trying to do (use Effect inside State)</p><h4 name="06cb" id="06cb" class="graf graf--h4 graf-after--p">StateT Monad</h4><ul class="postList"><li name="e48c" id="e48c" class="graf graf--li graf-after--h4">StateT monad takes three arguments,</li></ul><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="rust" name="65c0" id="65c0" class="graf graf--pre graf-after--li graf--preV2"><span class="pre--content">new<span class="hljs-keyword">type</span> <span class="hljs-title class_">StateT</span> s m a = <span class="hljs-title function_ invoke__">StateT</span> (s <span class="hljs-punctuation">-&gt;</span> <span class="hljs-title function_ invoke__">m</span> (Tuple a s)) </span></pre><p name="1a2d" id="1a2d" class="graf graf--p graf-after--pre"><code class="markup--code markup--p-code">s</code> and <code class="markup--code markup--p-code">a</code> we have already seen in <code class="markup--code markup--p-code">State</code> Monad</p><ul class="postList"><li name="b9cd" id="b9cd" class="graf graf--li graf-after--p"><code class="markup--code markup--li-code">s</code>â€Šâ€”â€Šstate the monad operates on.</li><li name="94ab" id="94ab" class="graf graf--li graf-after--li"><code class="markup--code markup--li-code">a</code>â€Šâ€”â€Šresulting value of the Monad.</li><li name="d64c" id="d64c" class="graf graf--li graf-after--li"><code class="markup--code markup--li-code">m</code>- the inner monad, we will be using <code class="markup--code markup--li-code">Effect</code> here.</li></ul><p name="3eea" id="3eea" class="graf graf--p graf-after--li">One interesting thing to note is, the <code class="markup--code markup--p-code">State</code> monad that we were using before is defined in terms of <code class="markup--code markup--p-code">StateT</code> only</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="bash" name="42e0" id="42e0" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-built_in">type</span> State s a = StateT s Identity a</span></pre><p name="f25d" id="f25d" class="graf graf--p graf-after--pre">Here, <code class="markup--code markup--p-code">Identity</code> is a fake monad, a monad which doesnâ€™t let us do any side Effect.</p><p name="5e63" id="5e63" class="graf graf--p graf-after--p graf--trailing">So we got to replace <code class="markup--code markup--p-code">Identity</code> with <code class="markup--code markup--p-code">Effect</code>Â . Thatâ€™s all we want to do.</p></div></div></section><section name="0b4f" class="section section--body"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h4 name="5c47" id="5c47" class="graf graf--h4 graf--leading">Rewriting code withÂ StateT</h4><p name="9287" id="9287" class="graf graf--p graf-after--h4">We want to import <strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em">StateT</em></strong> Monad now,</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="javascript" name="e676" id="e676" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Control</span>.<span class="hljs-property">Monad</span>.<span class="hljs-property">State</span>.<span class="hljs-property">Trans</span> <span class="hljs-keyword">as</span> S</span></pre><p name="9aca" id="9aca" class="graf graf--p graf-after--pre">and our type of <code class="markup--code markup--p-code">game</code> changes to</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="kotlin" name="9ecc" id="9ecc" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content">game :: S.StateT GameState Effect <span class="hljs-built_in">Unit</span></span></pre><h4 name="fb1a" id="fb1a" class="graf graf--h4 graf-after--pre">Still ErrorÂ ??</h4><p name="c533" id="c533" class="graf graf--p graf-after--h4">Having replaced <code class="markup--code markup--p-code">State</code> with <code class="markup--code markup--p-code">StateT</code> we are now hopeful that our <code class="markup--code markup--p-code">randomInt</code> function will compile, but if we again try doing</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="r" name="87c5" id="87c5" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content">damage <span class="hljs-operator">&lt;-</span> randomInt <span class="hljs-number">1</span> <span class="hljs-number">10</span></span></pre><p name="645a" id="645a" class="graf graf--p graf-after--pre">It will throw error telling that we canâ€™t use <code class="markup--code markup--p-code">Effect</code> inside <code class="markup--code markup--p-code">StateT</code></p><p name="d9df" id="d9df" class="graf graf--p graf-after--p">The compiler is not lying, we are inside <code class="markup--code markup--p-code">StateT</code>Â , we have to go one layer inside <code class="markup--code markup--p-code">StateT</code> to use <code class="markup--code markup--p-code">Effect</code></p><p name="01d9" id="01d9" class="graf graf--p graf-after--p">Consider it as stack, <code class="markup--code markup--p-code">StateT</code> is at top, <code class="markup--code markup--p-code">Effect</code> is one layer below it. So to use <code class="markup--code markup--p-code">Effect</code> function while being inside our <code class="markup--code markup--p-code">StateT</code> monad, we have to <code class="markup--code markup--p-code">lift</code> our <code class="markup--code markup--p-code">Effect</code> to <code class="markup--code markup--p-code">StateT</code>Â .</p><p name="d0cc" id="d0cc" class="graf graf--p graf-after--p">Thatâ€™s exactly what <code class="markup--code markup--p-code">lift</code> function from <code class="markup--code markup--p-code">Control.Monad.Trans.Class</code> does</p><figure name="c485" id="c485" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*f24suyipizgR_d_1TGxXzA.png" data-width="1290" data-height="104" src="https://cdn-images-1.medium.com/max/800/1*f24suyipizgR_d_1TGxXzA.png"><figcaption class="imageCaption"><code class="markup--code markup--figure-code">liftÂ :: forall s. Effect Int</code> -&gt; StateT s EffectÂ Int</figcaption></figure><p name="a286" id="a286" class="graf graf--p graf-after--figure">Once you do,</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="r" name="a02b" id="a02b" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content">damage <span class="hljs-operator">&lt;-</span> lift <span class="hljs-operator">$</span> randomInt <span class="hljs-number">1</span> <span class="hljs-number">10</span></span></pre><p name="bace" id="bace" class="graf graf--p graf-after--pre">Now the compiler starts showing error in our main function, where we are <code class="markup--code markup--p-code">running</code> are game.</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="yaml" name="1a84" id="1a84" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-string">let</span> { <span class="hljs-string">myLife</span>} <span class="hljs-string">=</span> <span class="hljs-string">S.execState</span> <span class="hljs-string">game</span> {<span class="hljs-attr">enemyLife :</span> <span class="hljs-number">3</span>, <span class="hljs-attr">myLife :</span> <span class="hljs-number">3</span>, <span class="hljs-attr">myChance :</span> <span class="hljs-literal">true</span>}</span></pre><p name="0085" id="0085" class="graf graf--p graf-after--pre">We have to replace <code class="markup--code markup--p-code">execState</code> with <code class="markup--code markup--p-code">execStateT</code>Â , and we will get <code class="markup--code markup--p-code">GameState</code> as result wrapped in <code class="markup--code markup--p-code">Effect</code> monad.</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="yaml" name="7299" id="7299" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-attr">main ::</span> <span class="hljs-string">Effect</span> <span class="hljs-string">Unit</span><br /><span class="hljs-string">main</span> <span class="hljs-string">=</span> <span class="hljs-string">do</span> <br />{ <span class="hljs-string">myLife</span>} <span class="hljs-string">&lt;-</span> <span class="hljs-string">S.execStateT</span> <span class="hljs-string">game</span> {<span class="hljs-attr">enemyLife :</span> <span class="hljs-number">3</span>, <span class="hljs-attr">myLife :</span> <span class="hljs-number">3</span>, <span class="hljs-attr">myChance :</span> <span class="hljs-literal">true</span>}<br /><span class="hljs-string">...</span></span></pre><p name="4517" id="4517" class="graf graf--p graf-after--pre">You can try out the modified code <a href="https://try.purescript.org/?code=LYewJgrgNgpgBAWQIYEsB2cDuALGAnGAKEJWAAcQ8AXOABQKgjCJPMpoBEkqkA6AMRBQwSAEaw4ACgBmQsAEpWFanACi06TADGNSes07FpZTQDCINFTxDeCC0jC8AKniRoAzr1NQk795KgUaSojNhUXAE9aCAIAZS08FDJdbABGABo4KhgADypMgjRmPFCTOHNLayhbe0dYnmznVw84XzhYpXY1DW0qXgAlNzAQYDhiKgiyeABxJGAYeu54AF44AG84GDQYYAiAGSD4AC4juABJS0zdg804E-PLOCuI02w3LWPTgCEQIRg3OBwAC%2BxEIAHM5p92rxFtknHBZvNYfB9L04ABVNAoKjgyFwVbDMaAwEQ%2BYAeQAbvg4AAeAC00LBMCo7ikAB1WXSAHxwTxbHb7Q605YABjgAB9xbzeNchTTRYpiVhcBhJGgQDRSTBKfh5HBhoQlUb1rtXu8YEDaQzYrwmTjjUqRMAkEyrXBAsE4AASODNYbAC40VJwVIiw0OwFBOCmt5oD5EiNKqgq6GgMBBCIAfTgHLg3N560221lt1WfOLgtuDKdLot4cTgJgUHc8BtaYz2dz%2BdZGxL8GJZZllfg1bmteB9YdbfAHZznJ57l7L1j8dW6ponhj5pBDa1k-3zvQd1OqJ0GKxOMPGAJIATS5uFrdNty2mR8K1635fbuIZFIueD4-qG-7Rsu5o-tISDNnWgKwDQmAWPicBRt%2BPJismWxwAARGccAAOoWFhmzQdhuF7CA7hUFh4aFMU3pwLIwiTgA2nAaRSNkeRYBY8gALpAA" data-href="https://try.purescript.org/?code=LYewJgrgNgpgBAWQIYEsB2cDuALGAnGAKEJWAAcQ8AXOABQKgjCJPMpoBEkqkA6AMRBQwSAEaw4ACgBmQsAEpWFanACi06TADGNSes07FpZTQDCINFTxDeCC0jC8AKniRoAzr1NQk795KgUaSojNhUXAE9aCAIAZS08FDJdbABGABo4KhgADypMgjRmPFCTOHNLayhbe0dYnmznVw84XzhYpXY1DW0qXgAlNzAQYDhiKgiyeABxJGAYeu54AF44AG84GDQYYAiAGSD4AC4juABJS0zdg804E-PLOCuI02w3LWPTgCEQIRg3OBwAC%2BxEIAHM5p92rxFtknHBZvNYfB9L04ABVNAoKjgyFwVbDMaAwEQ%2BYAeQAbvg4AAeAC00LBMCo7ikAB1WXSAHxwTxbHb7Q605YABjgAB9xbzeNchTTRYpiVhcBhJGgQDRSTBKfh5HBhoQlUb1rtXu8YEDaQzYrwmTjjUqRMAkEyrXBAsE4AASODNYbAC40VJwVIiw0OwFBOCmt5oD5EiNKqgq6GgMBBCIAfTgHLg3N560221lt1WfOLgtuDKdLot4cTgJgUHc8BtaYz2dz%2BdZGxL8GJZZllfg1bmteB9YdbfAHZznJ57l7L1j8dW6ponhj5pBDa1k-3zvQd1OqJ0GKxOMPGAJIATS5uFrdNty2mR8K1635fbuIZFIueD4-qG-7Rsu5o-tISDNnWgKwDQmAWPicBRt%2BPJismWxwAARGccAAOoWFhmzQdhuF7CA7hUFh4aFMU3pwLIwiTgA2nAaRSNkeRYBY8gALpAA" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">here</a>.</p><p name="fa7e" id="fa7e" class="graf graf--p graf-after--p graf--trailing">We can do a lot more. We can print the game stats at every iteration of game loop, we can even get input from user and decide what to do further etc. Iâ€™m leaving that as an exercise to you and your creative thinking skills.</p></div></div></section><section name="6fa1" class="section section--body section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><p name="ccb2" id="ccb2" class="graf graf--p graf--leading">Now you have earned the <strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em">super power</em></strong> to mutate variables at will with <code class="markup--code markup--p-code">State</code> Monad. Thatâ€™s why you have to use it carefully, <em class="markup--em markup--p-em">with great powers comes responsibility</em>. Try using pure function as much as you can, and limit your state Monad usage to a <a href="https://www.educative.io/answers/what-are-functional-core-and-imperative-shell-in-elixir" data-href="https://www.educative.io/answers/what-are-functional-core-and-imperative-shell-in-elixir" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">small shell</a>.</p><p name="4948" id="4948" class="graf graf--p graf-after--p"><code class="markup--code markup--p-code"><a href="https://pursuit.purescript.org/packages/purescript-transformers/6.0.0/docs/Control.Monad.Reader.Trans#t:ReaderT" data-href="https://pursuit.purescript.org/packages/purescript-transformers/6.0.0/docs/Control.Monad.Reader.Trans#t:ReaderT" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">ReaderT</a></code> monad is a better alternative if all you want is to read global State without doing any modification to it.</p><p name="f501" id="f501" class="graf graf--p graf-after--p graf--trailing">Hope you have enjoyed the article. Thank you for reading.</p></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@imsaravananm" class="p-author h-card">Saravanan M</a> on <a href="https://medium.com/p/f328e9b1ac66"><time class="dt-published" datetime="2023-03-08T16:09:22.276Z">March 8, 2023</time></a>.</p><p><a href="https://medium.com/@imsaravananm/working-with-state-monad-f328e9b1ac66" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on October 7, 2023.</p></footer></article></body></html>